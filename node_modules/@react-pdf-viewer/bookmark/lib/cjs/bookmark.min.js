"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@react-pdf-viewer/core");function t(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var n,o=t(require("react")),r=function(){return o.createElement(e.Icon,{size:16},o.createElement("path",{d:"M6.427,8.245A.5.5,0,0,1,6.862,7.5H17.138a.5.5,0,0,1,.435.749l-5.139,9a.5.5,0,0,1-.868,0Z"}))},a=function(){return o.createElement(e.Icon,{size:16},o.createElement("path",{d:"M9.248,17.572a.5.5,0,0,1-.748-.434V6.862a.5.5,0,0,1,.748-.434l8.992,5.138a.5.5,0,0,1,0,.868Z"}))},i=function(e){var t=e.bookmark,n=e.depth,i=e.doc,s=e.index,l=e.isBookmarkExpanded,u=e.numberOfSiblings,m=e.store,d=e.onJumpToDest,k=o.useMemo((function(){return function(e){var t=e.count,n=e.items;if(t>=0)return!1;var o=n.length;if(0===o)return!1;for(var r=n.concat([]);r.length>0;){var a=r.shift(),i=a.items;a.count&&i&&a.count>0&&i.length>0&&(o+=i.length,r=r.concat(i))}return Math.abs(t)===o}(t)}),[t]),f=l?l({bookmark:t,doc:i,depth:n,index:s}):!k,p=o.useState(f),b=p[0],v=p[1],E=t.items&&t.items.length>0;return o.createElement("li",{"aria-expanded":b?"true":"false","aria-label":t.title,"aria-level":n+1,"aria-posinset":s+1,"aria-setsize":u,role:"treeitem",tabIndex:-1},o.createElement("div",{className:"rpv-bookmark__item",style:{paddingLeft:"".concat(1.25*n,"rem")},onClick:function(){!E&&t.dest&&d(t.dest)}},E?o.createElement("span",{className:"rpv-bookmark__toggle",onClick:function(){return v((function(e){return!e}))}},b?o.createElement(r,null):o.createElement(a,null)):o.createElement("span",{className:"rpv-bookmark__toggle"}),t.url?o.createElement("a",{className:"rpv-bookmark__title",href:t.url,rel:"noopener noreferrer nofollow",target:t.newWindow?"_blank":""},t.title):o.createElement("div",{className:"rpv-bookmark__title","aria-label":t.title,onClick:function(){E&&t.dest&&d(t.dest)}},t.title)),E&&b&&o.createElement(c,{bookmarks:t.items,depth:n+1,doc:i,isBookmarkExpanded:l,isRoot:!1,store:m,onJumpToDest:d}))},c=function(e){var t=e.bookmarks,n=e.depth,r=void 0===n?0:n,a=e.doc,c=e.isBookmarkExpanded,s=e.isRoot,l=e.store,u=e.onJumpToDest;return o.createElement("ul",{className:"rpv-bookmark__list",role:s?"tree":"group",tabIndex:-1},t.map((function(e,n){return o.createElement(i,{bookmark:e,depth:r,doc:a,index:n,isBookmarkExpanded:c,key:n,numberOfSiblings:t.length,store:l,onJumpToDest:u})})))};!function(e){e[e.Collapse=0]="Collapse",e[e.Expand=1]="Expand"}(n||(n={}));var s=function(t){var r=t.bookmarks,a=t.doc,i=t.isBookmarkExpanded,s=t.store,l=t.onJumpToDest,u=o.useRef(),m=o.useState(s.get("linkAnnotations")||{}),d=m[0],k=m[1],f=function(e,t){var n=e.dest;n&&"string"==typeof n&&t[n]&&(t[n].querySelectorAll('a[data-annotation-link-dest="'.concat(n,'"]')).forEach((function(t){t.setAttribute("aria-label",e.title)})),e.items&&e.items.length&&e.items.forEach((function(e){return f(e,t)})))},p=function(e){return k(e)},b=function(e){var t=u.current;if(t&&e.target instanceof HTMLElement&&t.contains(e.target))switch(e.key){case"ArrowDown":e.preventDefault(),E((function(e,t){return e.indexOf(t)+1}));break;case"ArrowLeft":e.preventDefault(),g(n.Collapse);break;case"ArrowRight":e.preventDefault(),g(n.Expand);break;case"ArrowUp":e.preventDefault,E((function(e,t){return e.indexOf(t)-1}));break;case"End":e.preventDefault(),E((function(e,t){return e.length-1}));break;case" ":case"Enter":case"Space":e.preventDefault(),v();break;case"Home":e.preventDefault(),E((function(e,t){return 0}))}},v=function(){var e=document.activeElement.closest(".rpv-bookmark__item").querySelector(".rpv-bookmark__title");e&&e.click()},E=function(e){var t=u.current,n=[].slice.call(t.getElementsByClassName("rpv-bookmark__item"));if(0!==n.length){var o=document.activeElement,r=n[Math.min(n.length-1,Math.max(0,e(n,o)))];o.setAttribute("tabindex","-1"),r.setAttribute("tabindex","0"),r.focus()}},g=function(e){var t=u.current;if(0!==[].slice.call(t.getElementsByClassName("rpv-bookmark__item")).length){var o=document.activeElement.closest(".rpv-bookmark__item"),r=e===n.Collapse?"true":"false";if(o&&o.parentElement.getAttribute("aria-expanded")===r){var a=o.querySelector(".rpv-bookmark__toggle");a&&a.click()}}};return o.useEffect((function(){return document.addEventListener("keydown",b),s.subscribe("linkAnnotations",p),function(){document.removeEventListener("keydown",b),s.unsubscribe("linkAnnotations",p)}}),[]),o.useEffect((function(){r.forEach((function(e){return f(e,d)}))}),[d]),o.useEffect((function(){var e=u.current;if(e){var t=[].slice.call(e.getElementsByClassName("rpv-bookmark__item"));t.length>0&&(t[0].focus(),t[0].setAttribute("tabindex","0"))}}),[]),o.createElement("div",{ref:u},o.createElement(c,{bookmarks:r,depth:0,doc:a,isBookmarkExpanded:i,isRoot:!0,store:s,onJumpToDest:function(t){e.getDestination(a,t).then((function(e){var t=e.pageIndex,n=e.bottomOffset,o=e.leftOffset,r=e.scaleTo;l(t,n,o,r)}))}}))},l=function(t){var n=t.doc,r=t.isBookmarkExpanded,a=t.store,i=t.onJumpToDest,c=o.useContext(e.LocalizationContext).l10n,l=o.useContext(e.ThemeContext).direction===e.TextDirection.RightToLeft,u=o.useState({isLoaded:!1,items:[]}),m=u[0],d=u[1];return o.useEffect((function(){d({isLoaded:!1,items:[]}),n.getOutline().then((function(e){d({isLoaded:!0,items:e||[]})}))}),[n]),m.isLoaded?0===m.items.length?o.createElement("div",{"data-testid":"bookmark__empty",className:e.classNames({"rpv-bookmark__empty":!0,"rpv-bookmark__empty--rtl":l})},c&&c.bookmark?c.bookmark.noBookmark:"There is no bookmark"):o.createElement("div",{"data-testid":"bookmark__container",className:e.classNames({"rpv-bookmark__container":!0,"rpv-bookmark__container--rtl":l})},o.createElement(s,{bookmarks:m.items,doc:n,isBookmarkExpanded:r,store:a,onJumpToDest:i})):o.createElement("div",{className:"rpv-bookmark__loader"},o.createElement(e.Spinner,null))},u=function(t){var n=t.isBookmarkExpanded,r=t.store,a=o.useState(r.get("doc")),i=a[0],c=a[1],s=function(e){c(e)};return o.useEffect((function(){return r.subscribe("doc",s),function(){r.unsubscribe("doc",s)}}),[]),i?o.createElement(l,{doc:i,isBookmarkExpanded:n,store:r,onJumpToDest:function(e,t,n,o){var a=r.get("jumpToDestination");a&&a(e,t,n,o)}}):o.createElement("div",{className:"rpv-bookmark__loader"},o.createElement(e.Spinner,null))};exports.DownArrowIcon=r,exports.RightArrowIcon=a,exports.bookmarkPlugin=function(){var t=o.useMemo((function(){return e.createStore({linkAnnotations:{}})}),[]);return{install:function(e){t.update("jumpToDestination",e.jumpToDestination)},onDocumentLoad:function(e){t.update("doc",e.doc)},Bookmarks:function(e){return o.createElement(u,{isBookmarkExpanded:null==e?void 0:e.isBookmarkExpanded,store:t})},onAnnotationLayerRender:function(e){if(e.annotations.length){var n=e.annotations.filter((function(e){return"Link"===e.subtype}));if(n.length){var o=t.get("linkAnnotations")||{};n.forEach((function(t){return o[t.dest]=e.container})),t.update("linkAnnotations",o)}}}}};
