"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@react-pdf-viewer/core");function t(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(n){if("default"!==n){var r=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,r.get?r:{enumerable:!0,get:function(){return e[n]}})}})),t.default=e,Object.freeze(t)}var n=t(require("react")),r=function(){return n.createElement(e.Icon,{size:16},n.createElement("path",{d:"M6.427,8.245A.5.5,0,0,1,6.862,7.5H17.138a.5.5,0,0,1,.435.749l-5.139,9a.5.5,0,0,1-.868,0Z"}))},o=function(){return n.createElement(e.Icon,{size:16},n.createElement("path",{d:"M9.248,17.572a.5.5,0,0,1-.748-.434V6.862a.5.5,0,0,1,.748-.434l8.992,5.138a.5.5,0,0,1,0,.868Z"}))};var a,i=function(e){var t=e.count,n=e.items;if(t>=0)return!1;var r=n.length;if(0===r)return!1;for(var o=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}([],n,!0);o.length>0;){var a=o.shift(),i=a.items;a.count&&i&&a.count>0&&i.length>0&&(r+=i.length,o.push.apply(o,i))}return Math.abs(t)===r},c=function(e){var t=e.bookmark,a=e.depth,c=e.doc,l=e.index,u=e.isBookmarkExpanded,m=e.numberOfSiblings,d=e.store,f=e.onJumpToDest,k=n.useMemo((function(){return i(t)}),[t]),p=u?u({bookmark:t,doc:c,depth:a,index:l}):!k,b=n.useState(p),v=b[0],E=b[1],g=t.items&&t.items.length>0;return n.createElement("li",{"aria-expanded":v?"true":"false","aria-label":t.title,"aria-level":a+1,"aria-posinset":l+1,"aria-setsize":m,role:"treeitem",tabIndex:-1},n.createElement("div",{className:"rpv-bookmark__item",style:{paddingLeft:"".concat(1.25*a,"rem")},onClick:function(){!g&&t.dest&&f(t.dest)}},g?n.createElement("span",{className:"rpv-bookmark__toggle",onClick:function(){return E((function(e){return!e}))}},v?n.createElement(r,null):n.createElement(o,null)):n.createElement("span",{className:"rpv-bookmark__toggle"}),t.url?n.createElement("a",{className:"rpv-bookmark__title",href:t.url,rel:"noopener noreferrer nofollow",target:t.newWindow?"_blank":""},t.title):n.createElement("div",{className:"rpv-bookmark__title","aria-label":t.title,onClick:function(){g&&t.dest&&f(t.dest)}},t.title)),g&&v&&n.createElement(s,{bookmarks:t.items,depth:a+1,doc:c,isBookmarkExpanded:u,isRoot:!1,store:d,onJumpToDest:f}))},s=function(e){var t=e.bookmarks,r=e.depth,o=void 0===r?0:r,a=e.doc,i=e.isBookmarkExpanded,s=e.isRoot,l=e.store,u=e.onJumpToDest;return n.createElement("ul",{className:"rpv-bookmark__list",role:s?"tree":"group",tabIndex:-1},t.map((function(e,r){return n.createElement(c,{bookmark:e,depth:o,doc:a,index:r,isBookmarkExpanded:i,key:r,numberOfSiblings:t.length,store:l,onJumpToDest:u})})))};!function(e){e[e.Collapse=0]="Collapse",e[e.Expand=1]="Expand"}(a||(a={}));var l=function(t){var r=t.bookmarks,o=t.doc,i=t.isBookmarkExpanded,c=t.store,l=t.onJumpToDest,u=n.useRef(),m=n.useState(c.get("linkAnnotations")||{}),d=m[0],f=m[1],k=function(e,t){var n=e.dest;n&&"string"==typeof n&&t[n]&&(t[n].querySelectorAll('a[data-annotation-link-dest="'.concat(n,'"]')).forEach((function(t){t.setAttribute("aria-label",e.title)})),e.items&&e.items.length&&e.items.forEach((function(e){return k(e,t)})))},p=function(e){return f(e)},b=function(e){var t=u.current;if(t&&e.target instanceof HTMLElement&&t.contains(e.target))switch(e.key){case"ArrowDown":e.preventDefault(),E((function(e,t){return e.indexOf(t)+1}));break;case"ArrowLeft":e.preventDefault(),g(a.Collapse);break;case"ArrowRight":e.preventDefault(),g(a.Expand);break;case"ArrowUp":e.preventDefault,E((function(e,t){return e.indexOf(t)-1}));break;case"End":e.preventDefault(),E((function(e,t){return e.length-1}));break;case" ":case"Enter":case"Space":e.preventDefault(),v();break;case"Home":e.preventDefault(),E((function(e,t){return 0}))}},v=function(){var e=document.activeElement.closest(".rpv-bookmark__item").querySelector(".rpv-bookmark__title");e&&e.click()},E=function(e){var t=u.current,n=[].slice.call(t.getElementsByClassName("rpv-bookmark__item"));if(0!==n.length){var r=document.activeElement,o=n[Math.min(n.length-1,Math.max(0,e(n,r)))];r.setAttribute("tabindex","-1"),o.setAttribute("tabindex","0"),o.focus()}},g=function(e){var t=u.current;if(0!==[].slice.call(t.getElementsByClassName("rpv-bookmark__item")).length){var n=document.activeElement.closest(".rpv-bookmark__item"),r=e===a.Collapse?"true":"false";if(n&&n.parentElement.getAttribute("aria-expanded")===r){var o=n.querySelector(".rpv-bookmark__toggle");o&&o.click()}}};return n.useEffect((function(){return document.addEventListener("keydown",b),c.subscribe("linkAnnotations",p),function(){document.removeEventListener("keydown",b),c.unsubscribe("linkAnnotations",p)}}),[]),n.useEffect((function(){r.forEach((function(e){return k(e,d)}))}),[d]),n.useEffect((function(){var e=u.current;if(e){var t=[].slice.call(e.getElementsByClassName("rpv-bookmark__item"));t.length>0&&(t[0].focus(),t[0].setAttribute("tabindex","0"))}}),[]),n.createElement("div",{ref:u},n.createElement(s,{bookmarks:r,depth:0,doc:o,isBookmarkExpanded:i,isRoot:!0,store:c,onJumpToDest:function(t){e.getDestination(o,t).then((function(e){var t=e.pageIndex,n=e.bottomOffset,r=e.leftOffset,o=e.scaleTo;l(t,n,r,o)}))}}))},u=function(t){var r=t.doc,o=t.isBookmarkExpanded,a=t.store,i=t.onJumpToDest,c=n.useContext(e.LocalizationContext).l10n,s=n.useContext(e.ThemeContext).direction===e.TextDirection.RightToLeft,u=n.useState({isLoaded:!1,items:[]}),m=u[0],d=u[1];return n.useEffect((function(){d({isLoaded:!1,items:[]}),r.getOutline().then((function(e){d({isLoaded:!0,items:e||[]})}))}),[r]),m.isLoaded?0===m.items.length?n.createElement("div",{"data-testid":"bookmark__empty",className:e.classNames({"rpv-bookmark__empty":!0,"rpv-bookmark__empty--rtl":s})},c&&c.bookmark?c.bookmark.noBookmark:"There is no bookmark"):n.createElement("div",{"data-testid":"bookmark__container",className:e.classNames({"rpv-bookmark__container":!0,"rpv-bookmark__container--rtl":s})},n.createElement(l,{bookmarks:m.items,doc:r,isBookmarkExpanded:o,store:a,onJumpToDest:i})):n.createElement("div",{className:"rpv-bookmark__loader"},n.createElement(e.Spinner,null))},m=function(t){var r=t.isBookmarkExpanded,o=t.store,a=n.useState(o.get("doc")),i=a[0],c=a[1],s=function(e){c(e)};return n.useEffect((function(){return o.subscribe("doc",s),function(){o.unsubscribe("doc",s)}}),[]),i?n.createElement(u,{doc:i,isBookmarkExpanded:r,store:o,onJumpToDest:function(e,t,n,r){var a=o.get("jumpToDestination");a&&a(e,t,n,r)}}):n.createElement("div",{className:"rpv-bookmark__loader"},n.createElement(e.Spinner,null))};exports.DownArrowIcon=r,exports.RightArrowIcon=o,exports.bookmarkPlugin=function(){var t=n.useMemo((function(){return e.createStore({linkAnnotations:{}})}),[]);return{install:function(e){t.update("jumpToDestination",e.jumpToDestination)},onDocumentLoad:function(e){t.update("doc",e.doc)},Bookmarks:function(e){return n.createElement(m,{isBookmarkExpanded:null==e?void 0:e.isBookmarkExpanded,store:t})},onAnnotationLayerRender:function(e){if(e.annotations.length){var n=e.annotations.filter((function(e){return"Link"===e.subtype}));if(n.length){var r=t.get("linkAnnotations")||{};n.forEach((function(t){return r[t.dest]=e.container})),t.update("linkAnnotations",r)}}}}};
